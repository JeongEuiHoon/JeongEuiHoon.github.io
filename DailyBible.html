<!doctype html>
<!-- 
http://gapck.org/publish/notice/notice_read.asp?hno=140&BGNO=1034

※ 2022 교회절기 및 행사
신년감사주일 1월 2일
이단경계주일 2월 6일
종려주일 4월 10일
고난주간 4월 11일~16일
부활주일 4월 17일
장애인주일 4월 17일
어린이주일 5월 1일
어버이주일 5월 8일
성령강림절 6월 5일
순교자기념주일 6월 19일
순교자기념주간 6월 20일~25일
맥추감사주일 7월 3일
이단경계주일 9월 4일
종교개혁주일 10월 30일
추수감사주일 11월 20일
성서주일 12월 11일
성탄절 12월 25일
송구영신예배 12월 31일
-->
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="Author" content="Johnnie Hoon">
		<meta name="Keywords" content="매일성경 오늘의 말씀">
		<meta name="Description" content="매일성경 오늘의 말씀">
		<title>매일성경 오늘의 말씀</title>
		<link rel="shortcut icon" href="https://sum.su.or.kr:8888/Themes/main/images/logo2.png">
		<link rel="apple-touch-icon" href="https://sum.su.or.kr:8888/Themes/main/images/logo2.png">
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" />  
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>  
		<script src="https://code.jquery.com/ui/1.8.18/jquery-ui.min.js"></script>  

		<!-- script type="text/javascript" src="jquery.ajax-cross-origin.min.js"></script -->
		<!-- CORS 된다고 했지만, 안됨. 241라인의 cors.bridged.cc를 프록시로 이용해서 제공 -->

		<!-- 달력 표시를 위한 datepicker -->
		<script>
			$( function() {
				$( ".datepicker" ).datepicker({dateFormat: "yy-mm-dd"});
			} );
		</script>

		<script>
			var date;	// 말씀 날짜
			var bibleType = "QT1"; // QT1 개정 / QT2 쉬운성경 / QT6 새번역 / QT5 영어
			var proxy4ChromeCORS = "";	// 크롬에서 CORS 회피를 위한 proxy. IE에서는 필요없음
			var textArray = ['복된','은혜로운','즐거운','감사하는'];	// 평일 문구에 표시되는 형용사
			var liturgicalYear = new Map();	// 교회력, title : 교회력 명칭, msg : 교회력날에 표시되는 형용사
				liturgicalYear.set("2022.01.02",{title:"신년감사주일",msg:"감사하는"});
				liturgicalYear.set("2022.02.06",{title:"이단경계주일",msg:"복된"});
				liturgicalYear.set("2022.04.10",{title:"종려주일",msg:"감사하는"});
				liturgicalYear.set("2022.04.11",{title:"고난주간",msg:"감사하는"});
				liturgicalYear.set("2022.04.12",{title:"고난주간",msg:"감사하는"});
				liturgicalYear.set("2022.04.13",{title:"고난주간",msg:"감사하는"});
				liturgicalYear.set("2022.04.14",{title:"고난주간",msg:"감사하는"});
				liturgicalYear.set("2022.04.15",{title:"고난주간",msg:"감사하는"});
				liturgicalYear.set("2022.04.16",{title:"고난주간",msg:"감사하는"});
				liturgicalYear.set("2022.04.17",{title:"부활주일이자 장애인주일",msg:"감사하는"});
				liturgicalYear.set("2022.05.01",{title:"어린이주일",msg:"즐거운"});
				liturgicalYear.set("2022.05.08",{title:"어버이주일",msg:"감사하는"});
				liturgicalYear.set("2022.06.05",{title:"성령강림절",msg:"감사하는"});
				liturgicalYear.set("2022.06.19",{title:"순교자기념주일",msg:"감사하는"});
				liturgicalYear.set("2022.06.20",{title:"순교자기념주간",msg:"감사하는"});
				liturgicalYear.set("2022.06.21",{title:"순교자기념주간",msg:"감사하는"});
				liturgicalYear.set("2022.06.22",{title:"순교자기념주간",msg:"감사하는"});
				liturgicalYear.set("2022.06.23",{title:"순교자기념주간",msg:"감사하는"});
				liturgicalYear.set("2022.06.24",{title:"순교자기념주간",msg:"감사하는"});
				liturgicalYear.set("2022.06.25",{title:"순교자기념주간",msg:"감사하는"});
				liturgicalYear.set("2022.07.03",{title:"맥추감사주일",msg:"감사하는"});
				liturgicalYear.set("2022.09.04",{title:"이단경계주일",msg:"복된"});
				liturgicalYear.set("2022.10.30",{title:"종교개혁주일",msg:"은혜로운"});
				liturgicalYear.set("2022.11.20",{title:"추수감사주일",msg:"감사하는"});
				liturgicalYear.set("2022.12.11",{title:"성서주일",msg:"감사하는"});
				liturgicalYear.set("2022.12.25",{title:"성탄절",msg:"복된"});
				liturgicalYear.set("2022.12.31",{title:"송구영신예배",msg:"감사하는"});
				liturgicalYear.set("2022.01.01",{title:"새해 첫날",msg:"복된"});
				liturgicalYear.set("2022.02.01",{title:"설날",msg:"즐겁고 복된"});
				liturgicalYear.set("2022.03.01",{title:"삼일절",msg:"호국 영령들을 기리는"});
				liturgicalYear.set("2022.06.06",{title:"현충일",msg:"호국 영령들을 기리는"});
				liturgicalYear.set("2022.08.15",{title:"광복절",msg:"순국 선열들의 숭고한 애국정신을 기리는"});
				liturgicalYear.set("2022.09.10",{title:"추석",msg:"즐겁고 복된"});
			function getDateInfo() {
				$.ajax( {
					type:'POST',
					contentType:"application/json;charset=utf-8",
					url:proxy4ChromeCORS+"https://sum.su.or.kr:8888/Ajax/Bible/BodyTop",
					data:"{'qt_ty':'" + bibleType + "','Base_de':'"+date+"'}",
					crossOrigin:true,
					dataType:'JSON',
					success:function(response) {
						if(response != null) {
							$('#bible_date').html("");
							$('#bible_date').append(response.BibleDay + "(" + response.BibleDateGetWeek + ")");

							var toDate = response.BibleDay.split(".");
							var isSunday = ('일' == response.BibleDateGetWeek);
							var randomNumber = Math.floor(Math.random()*textArray.length);

							var headerMessage = toDate[0] + "년 " + toDate[1] + "월 " + toDate[2] + "일 " + response.BibleDateGetWeek + "요일입니다. ";
							var titleMessage = "";
							var contentMessage = textArray[(isSunday? 1 : randomNumber)];
							var footerMessage = ((isSunday? " 주일" : " 하루") + " 맞이하시길 바라며 오늘의 말씀을 전해드립니다.");

							if(liturgicalYear.has(response.BibleDay)) {
								titleMessage = "오늘은 " + liturgicalYear.get(response.BibleDay).title + "입니다. ";
								contentMessage = liturgicalYear.get(response.BibleDay).msg;
							}
							$('#to_date').html(headerMessage+titleMessage+contentMessage+footerMessage);

							getHeader();
						}
					},
					error:function(err) {
						var err1 = err;
					}
				});
			}
			function getHeader() {
				$('#subject').html("");
				$.ajax({
					type:'POST',
					contentType:"application/json;charset=utf-8",
					url:proxy4ChromeCORS+"https://sum.su.or.kr:8888/Ajax/Bible/BodyMatterDetail",
					data:"{'qt_ty':'" + bibleType + "','Base_de':'"+date+"'}",
					dataType:'JSON',
					success:function (response) {
						if(response != null) {
							if((response.Qt_sj != '') & (response.Qt_sj != null)) {
								$('#subject').append(response.Qt_sj.trim());
							}

							$('#bible_date').append(' : ');
							$('#bible_date').append('[');
							$('#bible_date').append(response.Bible_name.trim());
							$('#bible_date').append(' ');
							$('#bible_date').append(response.Bible_chapter.trim());
							switch(bibleType) {	// QT1 개정 / QT2 쉬운성경 / QT6 새번역 / QT5 영어
								case 'QT1' : $('#bible_date').append(' 개정개역');break;
								case 'QT2' : $('#bible_date').append(' 쉬운성경');break;
								case 'QT6' : $('#bible_date').append(' 새번역');break;
								case 'QT5' : $('#bible_date').append(' 영어');break;
							}
							$('#bible_date').append(']');
							$('#bible_date').append(' 찬송가 ');
							$('#bible_date').append(response.New_song);
							$('#bible_date').append('장');

							getBody();
						}
					},
					error:function (err) {
						var err1 = err;
						}
					});
			}
			function getBody() {
				$.ajax({
					type:'POST',
					contentType:"application/json;charset=utf-8",
					url:proxy4ChromeCORS+"https://sum.su.or.kr:8888/Ajax/Bible/BodyBible",
					data:"{'qt_ty':'"+bibleType+"','Base_de':'"+date+"'}",	
					dataType:'JSON',
					success:function (response) {
						if(response != null) {
							var str = "";
							$('#bible_body_list').html("");
							for (var i = 0; i < response.length; i++) {
								str = str + response[i].Chapter + ":" + response[i].Verse + ":" + response[i].Bible_Cn.trim() + "<br>";
							};
							$('#bible_body_list').append(str);
							getCommentary();
						}
					},
					error:function (err) {
						var err1 = err;
						}
					});
			}
			function getCommentary() {
				$('#Qt_Brf').html("");		// 해설
				$('#Qt_q1_str').html("");	// 하나님은 어떤 분입니까?
				$('#Qt_q2_str').html("");	// 내게 주시는 교훈은 무엇입니까?
				$('#Qt_q3_str').html("");	// 기도
				$('#end_str').html("");	// 아멘

				var briefType = "QT1"; // QT1 개정 / QT2 쉬운성경 / QT6 새번역 / QT5 영어

				$.ajax( {
					type:'POST',
					contentType:"application/json;charset=utf-8",
					url:proxy4ChromeCORS+"https://sum.su.or.kr:8888/Ajax/Bible/BodyBibleCont",
					data:"{'qt_ty':'"+briefType+"','Base_de':'"+date+"','Bibletype':'1'}",
					dataType:'JSON',
					success:function(response) {
						if(response != null) {
							var str = "";
								// 해설
								if((response.Qt_Brf != '') && (response.Qt_Brf != null)) {
									$('#Qt_Brf').append(response.Qt_Brf.trim());
								}
								// 하나님은 어떤 분입니까?
								if((response.Qt_a1 != '') && (response.Qt_a1 != null)) {
									$('#Qt_q1_str').html('['+response.Qt_q1_str+']<br>');
									$('#Qt_q1_str').append(response.Qt_a1.trim());
								}
								// 내게 주시는 교훈은 무엇입니까?
								if((response.Qt_a2 != '') && (response.Qt_a2 != null)) {
									$('#Qt_q2_str').html('['+response.Qt_q2_str+']<br>');
									$('#Qt_q2_str').append(response.Qt_a2.trim());
								}
/*								// 기도
								if((response.Qt_a3 != '') & (response.Qt_a3 != null)) {
									$('#Qt_q3_str').html('['+response.Qt_q3_str+']<br>');
									$('#Qt_q3_str').append(response.Qt_a3.trim());
								}
*/
								$('#end_str').append('아멘!');
//								startDate = new Date(startDate.setDate(startDate.getDate() + 1)); //date increase by 1
						}
					},
					error:function (err) {
						var err1 = err;
						}
					});
			}
			function getBible() {
//				startDate = new Date("2019-03-05");// startDate = new Date();
//				endDate = new Date(startDate.setDate(startDate.getDate() + 7));

				getDateInfo();
			}
			function requestProxy() {
				// http://cors-anywhere.herokuapp.com/corsdemo
				window.open('http://cors-anywhere.herokuapp.com/corsdemo','PROXY','width=320,height=250');
				// 프락시임시 오픈 요청 후 프락시 호출해야 동작함
			}
			function init(diff) {
				var isChrome = window.navigator.userAgent.indexOf('Chrome') > 0;
				if(isChrome) {
					// requestProxy()에서 herokuapp의 임시서버를 사용함
					proxy4ChromeCORS = "https://cors-anywhere.herokuapp.com/";
					proxy4ChromeCORS = "http://cors-anywhere.herokuapp.com/";
//					proxy4ChromeCORS = "https://robwu.nl/cors-anywhere.html/";
//					proxy4ChromeCORS = "https://cors-proxy.htmldriven.com/?url=";
// cors-anywhere.herokuapp.com 동작 안해서 cors.bridged.cc로 교체
//					proxy4ChromeCORS = "https://cors.bridged.cc/";
//alert(proxy4ChromeCORS)
				}

				if(diff) {
					switch(diff) {	// today, prev, next
						case 'today' : 
							contentsDate = new Date();
							diff = 0;
							break;
						case 'prev' : 
							contentsDate = new Date($('#bibleDate').val());
							diff = -1;
							break;
						case 'next' : 
							contentsDate = new Date($('#bibleDate').val());
							diff = 1;
							break;
					}
					contentsDate.setDate(contentsDate.getDate() + diff);
					contentsDate.setMinutes(contentsDate.getMinutes() - contentsDate.getTimezoneOffset());
					date = contentsDate.toISOString().slice(0,10);

					$('#bibleDate').val(date);
				}
				else {
					if($('#bibleDate').val().replace(/\s/g,"") == ""){
						var contentsDate = new Date();
						contentsDate.setMinutes(contentsDate.getMinutes() - contentsDate.getTimezoneOffset());
						date = contentsDate.toISOString().slice(0,10);

						$('#bibleDate').val(date);
					}
					else {
						date = $('#bibleDate').val();
					}
				}
				bibleType = $('input:radio[name="checkedBibleType"]:checked').val();
				getBible();
			}

			function contentsCopy() {
				var copyDivArea = document.getElementById("Contents");
				var copyText = copyDivArea.innerText;

				while(copyText.indexOf('\n ') > 0) {
					copyText = copyText.replace(/\n /g, "\n");//행바꿈 뒤에 빈칸제거
				}
				if(copyText.indexOf('\n\r\n\r') > 0) {
					while(copyText.indexOf('\n\r\n\r') > 0) {
						copyText = copyText.replace(/\n\r\n\r/g, "\n\r");//두개의 행바꿈을 하나로
					}
				}
				else if(copyText.indexOf('\n\n\n') > 0) {
					while(copyText.indexOf('\n\n\n') > 0) {
						copyText = copyText.replace(/\n\n\n/g, "\n\n");//두개의 행바꿈을 하나로
					}
				}

				var $temp = $("<textarea id='a1'>");
				$("body").append($temp);
				// $temp.css('display', 'none'); // ie에서 안됨
				$temp.val(copyText).select();
				document.execCommand("copy");
				$temp.remove();
				$('html').scrollTop(0);
			}
			function CopyAndNext() {
				contentsCopy();
				init('next');
			}
			function googleTTS() {
/*
				$.ajax( {
					type:'POST',
					contentType:"application/json;charset=utf-8",
					url:"https://texttospeech.googleapis.com/v1beta1/text:synthesize",
					data:"{'audioConfig':{'audioEncoding': 'LINEAR16', 'pitch': 0, 'speakingRate': 1 },'input':{'text':'안녕하세요'},'voice':{'languageCode':'ko-KR','name':'ko-KR-Wavenet-B'}}",
					dataType:'JSON',
					success:function(response) {
						var err1 = err;
					},
					error:function (err) {
						var err1 = err;
					}
					});
*/
			}

			function isNotEmpty (_str){
				obj = String(_str);
				if(obj == null || obj == undefined || obj == 'null' || obj == 'undefined' || obj == '' ) return false;
				else return true;
			}

			function isEmpty (_str){
				return !isNotEmpty(_str);
			}

		</script>
	</head>
	<body id=myBody onload=init()>
		<a href="#" onClick=init('prev')><i class="fas fa-arrow-left"></i></a>
		<input type=text class='datepicker' id='bibleDate' value=''><input type=button value='GO' onclick=init()>
		<a href="#" onClick=init('next')><i class="fas fa-arrow-right"></i></a>
		<a href="#" onClick=init('today')><i class="fas fa-calendar-day"></i></a>
		<button type="button" onClick=requestProxy()>Proxy</button>
		<button type="button" onClick=contentsCopy()>Copy</button>
		<button type="button" onClick=CopyAndNext()>Copy&Next</button>
		<button type="button" onClick=googleTTS() style="display:none">TTS</button>
		<input type=radio name=checkedBibleType value='QT1'>개정개역
		<input type=radio name=checkedBibleType value='QT2' checked>쉬운성경
		<input type=radio name=checkedBibleType value='QT6'>새번역
		<input type=radio name=checkedBibleType value='QT5'>영어

		<br>
		<div id='Contents'>
		<div id='to_date'></div><br>
		<br>
		[제목]
		<div id='subject'></div>
		<br>
		[본문]
		<div id='bible_date'></div>
		<div id='bible_body_list'></div>
		<br>
		[해설]
		<div id='Qt_Brf'></div>

		<div id='Qt_q1_str'></div>

		<div id='Qt_q2_str'></div>

		<div id='Qt_q3_str'></div>
		<div id='end_str'></div>
		</div>
	</body>
</html>
